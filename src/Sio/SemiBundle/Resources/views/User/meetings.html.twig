{% extends "SioSemiBundle::layout.html.twig" %}

{% block content %}
    {% set oldIdS, oldDateHeureDebut = '', date() %}
    {% set seanceSave = null %}
    {% set strClass = '' %}
    <div class="row">
        <div class="col-md-12">
            <center><h2>{{ title }}</h2>{{ description }}</center>
            <hr>
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Informations sur mes inscriptions</h3>
                </div>
                <div class="panel-body" id='statNbSeanceInscr'>
                    Vous êtes actuellement inscrit(e) à {{ nbMeetingRegister }} séances sur ce séminaire.
                </div>
            </div>
            <div id="content">
                {% set i, classSeancesParalleles, oddEvenclass = 0, 'odd_row', 'event_row' %}
                {% for jour, seances in meetings %}
                    <h3 id="{{ jour }}"><a href="#{{ jour }}">{{ jour }} : {{ seances|length }} séances</a></h3>
                    <div>
                        <table class="table table-hover table-bordered">
                            <thead>
                                <tr>
                                    {% if stateSeminar == 'Open' %}<th class="dataTableHeader" style="width:10%;">Je m'inscris</th>{% endif %}
                                    <th class="dataTableHeader" style="width:10%;">Disponibilités</th>
                                    <th class="dataTableHeader" style="width:10%;">Type</th>
                                    <th class="dataTableHeader" style="width:10%;">Horaires</th>
                                    <th class="dataTableHeader" style="width:35%;">Seance</th>
                                    <th class="dataTableHeader" style="width:25%;">Intervenants</th>
                                </tr>
                            </thead>
                            <tbody>	 
                                {% for seancesHoraire in seances %}
                                    {% set seancesParalleles = seancesHoraire|length > 1 %}
                                    {% if seancesParalleles %}
                                        {% set oddEvenclass = (seancesParalleles) ? classSeancesParalleles : ((oddEvenclass == 'even_row') ? 'odd_row' : 'even_row') %}
                                        {% set classInput = 'radio' %}
                                        {% set i = i + 1 %}
                                    {% else %}
                                        {% set classInput = 'checkbox' %}
                                        {% set strClass = '' %}
                                    {% endif %}
                                    {% set isChecked, numLigneMemeHoraire = 'false', 0 %}       
                                    {% for seance in seancesHoraire %}
                                        {%if seance.register == 1 %}{% set isChecked = 'true' %}{% endif %}
                                        {% set oddEvenclass = (seancesParalleles) ? classSeancesParalleles : ((oddEvenclass == 'even_row') ? 'odd_row' : 'even_row') %}
                                        {% if seance.type == 'atelier' %}
                                            {% set strClass = '_atelier' %}
                                        {% endif %}
                                        <tr class='{{ oddEvenclass }}{{ strClass }}'> 
                                            {% if stateSeminar == 'Open' %}
                                                <td>
                                                    <input id='cb{{ seance.id }}' 
                                                           type='{{ classInput }}' 
                                                           name='inscrire{{ seancesParalleles ? i : ''}}' 
                                                           {% if seance.register == 1 %}checked{% endif %} 
                                                           {% if seance.dispo<=0 and seance.idParticipant %}
                                                               disabled
                                                           {% else %}
                                                             onClick='inscrSeance("{{ seance.id }}", "{{ seance.realDateHeureDebut|date('Y-m-d H:i:s') }}", "{{ seance.description | escape('js')}}...", this.checked)' /> 
                                                    </td>
                                                {% endif %}
                                            {% endif %}

                                            <td id='{{ seance.id }}'>{{ seance.dispo }} / {{ seance.maxSeats }} {% if seance.dispo <= 0 %}complet{% endif %}</td>
                                            <td>{{ seance.type }}</td>
                                            <td>{{ seance.dateHeureDebut }} - {{ seance.dateHeureFin }}</td>
                                            <td>{% if seance.type == 'atelier' %}({{ seance.relativeNumber }}) {% endif %}{{ seance.description }}</td>
                                            <td>{{ seance.stakeholders }}</td>
                                            {% set oldIdS, oldDateHeureDebut, seanceSave = seance.id, seance.dateHeureDebut, seance %}
                                        </tr>
                                    {% endfor %}
                                    {% if seancesParalleles %}
                                        <tr class='{{ oddEvenclass }}{{ strClass }}'> 
                                            {% if stateSeminar == 'Open' %}
                                                <td>
                                                    <input id='cbRAZ{{ oldIdS }}' 
                                                           type='{{ classInput }}' 
                                                           name='inscrire{{ (seancesParalleles) ? i : ''}}' 
                                                           {% if isChecked == 'false' %}checked {% endif %}
                                                               onClick='inscrSeance({{ oldIdS }}, "{{ seanceSave.realDateHeureDebut|date('Y-m-d H:i:s') }}", "Non merci", false)' 
                                                               /> 
                                                    </td>
                                                
                                                <td>Non merci</td>
                                                <td> </td>
                                                <td> </td>
                                                <td>Non merci</td>
                                                <td> </td>
                                            {% endif %}
                                        {% endif %}

                                    {% endfor %}
                            <tbody>  	 
                        </table>
                    </div>
                {% endfor %}

            </div>
        </div>
    </div>
{% endblock %}